<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post Service Test Interface</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .response {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .error {
            color: red;
        }
        .success {
            color: green;
        }
        .section-title {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>Post Service Test Interface</h1>
    <p>Base URL: <strong>http://localhost:8085</strong></p>

    <!-- Create Post Section -->
    <div class="container">
        <h2 class="section-title">Create Post with Media Upload</h2>
        <form id="createPostForm">
            <div class="form-group">
                <label for="title">Title *:</label>
                <input type="text" id="title" required placeholder="Enter post title">
            </div>
            <div class="form-group">
                <label for="content">Content *:</label>
                <textarea id="content" rows="4" required placeholder="Enter post content"></textarea>
            </div>
            <div class="form-group">
                <label for="authorId">Author ID *:</label>
                <input type="text" id="authorId" required value="user123" placeholder="Enter user ID">
            </div>
            <div class="form-group">
                <label for="category">Category:</label>
                <select id="category">
                    <option value="">Select Category</option>
                    <option value="technology">Technology</option>
                    <option value="education">Education</option>
                    <option value="sports">Sports</option>
                    <option value="entertainment">Entertainment</option>
                    <option value="news">News</option>
                </select>
            </div>
            <div class="form-group">
                <label for="tags">Tags (comma separated):</label>
                <input type="text" id="tags" placeholder="tag1, tag2, tag3">
            </div>
            <div class="form-group">
                <label for="files">Upload Files (Images, Videos, Documents):</label>
                <input type="file" id="files" multiple accept="image/*,video/*,audio/*,.pdf,.doc,.docx">
            </div>
            <button type="submit">Create Post</button>
        </form>
        <div id="createResponse" class="response" style="display: none;"></div>
    </div>

    <!-- Get Posts Section -->
    <div class="container">
        <h2 class="section-title">Browse Posts</h2>
        <div class="form-group">
            <label for="searchTerm">Search Term:</label>
            <input type="text" id="searchTerm" placeholder="Search in title and content...">
        </div>
        <div class="form-group">
            <label for="categoryFilter">Filter by Category:</label>
            <select id="categoryFilter">
                <option value="">All Categories</option>
                <option value="technology">Technology</option>
                <option value="education">Education</option>
                <option value="sports">Sports</option>
                <option value="entertainment">Entertainment</option>
                <option value="news">News</option>
            </select>
        </div>
        <div class="form-group">
            <label for="authorFilter">Filter by Author ID:</label>
            <input type="text" id="authorFilter" placeholder="Enter author ID">
        </div>
        <button onclick="getPosts()">Get All Posts</button>
        <button onclick="searchPosts()">Search/Filter Posts</button>
        <div id="postsResponse" class="response" style="display: none;"></div>
    </div>

    <!-- Post Details Section -->
    <div class="container">
        <h2 class="section-title">Get Post Details (Auto-record View)</h2>
        <div class="form-group">
            <label for="postId">Post ID *:</label>
            <input type="text" id="postId" placeholder="Enter post ID">
        </div>
        <div class="form-group">
            <label for="viewerId">Viewer ID (for view tracking):</label>
            <input type="text" id="viewerId" placeholder="Enter user ID" value="viewer123">
        </div>
        <button onclick="getPostDetails()">Get Post Details</button>
        <div id="postDetailsResponse" class="response" style="display: none;"></div>
    </div>

    <!-- Update Post Section -->
    <div class="container">
        <h2 class="section-title">Update Post (Author Only)</h2>
        <div class="form-group">
            <label for="updatePostId">Post ID *:</label>
            <input type="text" id="updatePostId" placeholder="Enter post ID">
        </div>
        <div class="form-group">
            <label for="updateAuthorId">Author ID *:</label>
            <input type="text" id="updateAuthorId" placeholder="Enter author ID" value="user123">
        </div>
        <div class="form-group">
            <label for="updateTitle">New Title:</label>
            <input type="text" id="updateTitle" placeholder="Enter new title">
        </div>
        <div class="form-group">
            <label for="updateContent">New Content:</label>
            <textarea id="updateContent" rows="3" placeholder="Enter new content"></textarea>
        </div>
        <div class="form-group">
            <label for="updateCategory">New Category:</label>
            <select id="updateCategory">
                <option value="">No change</option>
                <option value="technology">Technology</option>
                <option value="education">Education</option>
                <option value="sports">Sports</option>
                <option value="entertainment">Entertainment</option>
                <option value="news">News</option>
            </select>
        </div>
        <button onclick="updatePost()">Update Post</button>
        <div id="updateResponse" class="response" style="display: none;"></div>
    </div>

    <!-- Interactions Section -->
    <div class="container">
        <h2 class="section-title">Post Interactions</h2>
        <div class="form-group">
            <label for="interactionPostId">Post ID *:</label>
            <input type="text" id="interactionPostId" placeholder="Enter post ID">
        </div>
        <div class="form-group">
            <label for="interactionUserId">User ID *:</label>
            <input type="text" id="interactionUserId" placeholder="Enter user ID" value="user123">
        </div>
        <button onclick="likePost()">üëç Like/Unlike</button>
        <button onclick="sharePost()">üì§ Share</button>
        <button onclick="bookmarkPost()">üîñ Bookmark</button>
        <button onclick="checkLikeStatus()">Check Like Status</button>
        <button onclick="checkBookmarkStatus()">Check Bookmark Status</button>
        <div id="interactionResponse" class="response" style="display: none;"></div>
    </div>

    <!-- Comments Section -->
    <div class="container">
        <h2 class="section-title">Comments Management</h2>
        <div class="form-group">
            <label for="commentPostId">Post ID *:</label>
            <input type="text" id="commentPostId" placeholder="Enter post ID">
        </div>
        <div class="form-group">
            <label for="commentContent">Comment Content *:</label>
            <textarea id="commentContent" rows="3" placeholder="Enter your comment"></textarea>
        </div>
        <div class="form-group">
            <label for="commentAuthorId">Author ID *:</label>
            <input type="text" id="commentAuthorId" placeholder="Enter user ID" value="user123">
        </div>
        <div class="form-group">
            <label for="parentCommentId">Parent Comment ID (for replies):</label>
            <input type="text" id="parentCommentId" placeholder="Enter parent comment ID (optional)">
        </div>
        <button onclick="addComment()">üí¨ Add Comment</button>
        <button onclick="getComments()">üìú Get Comments</button>
        <div id="commentResponse" class="response" style="display: none;"></div>
    </div>

    <!-- Admin Section -->
    <div class="container">
        <h2 class="section-title">Admin Functions</h2>
        <button onclick="getTopViewedPosts()">üìä Top Viewed Posts</button>
        <button onclick="getTopLikedPosts()">‚ù§Ô∏è Top Liked Posts</button>
        <button onclick="getPlatformStats()">üìà Platform Statistics</button>
        <div class="form-group">
            <label for="adminUserId">User ID for Stats:</label>
            <input type="text" id="adminUserId" placeholder="Enter user ID" value="user123">
            <button onclick="getUserStats()">üë§ Get User Stats</button>
        </div>
        <div id="adminResponse" class="response" style="display: none;"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8085/api';

        // Create Post with File Upload
        document.getElementById('createPostForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData();

            const postData = {
                title: document.getElementById('title').value,
                content: document.getElementById('content').value,
                authorId: document.getElementById('authorId').value,
                category: document.getElementById('category').value,
                tags: document.getElementById('tags').value.split(',').map(tag => tag.trim()).filter(tag => tag)
            };

            formData.append('post', new Blob([JSON.stringify(postData)], {type: 'application/json'}));

            const files = document.getElementById('files').files;
            for (let i = 0; i < files.length; i++) {
                formData.append('files', files[i]);
            }

            try {
                const response = await fetch(`${API_BASE}/posts`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                displayResponse('createResponse', result, response.ok);

                if (response.ok) {
                    document.getElementById('createPostForm').reset();
                }
            } catch (error) {
                displayResponse('createResponse', {error: error.message}, false);
            }
        });

        // Get Posts
        async function getPosts() {
            try {
                const response = await fetch(`${API_BASE}/posts?page=0&size=10&sortBy=createdAt&sortDir=desc`);
                const result = await response.json();
                displayResponse('postsResponse', result, response.ok);
            } catch (error) {
                displayResponse('postsResponse', {error: error.message}, false);
            }
        }

        // Search/Filter Posts
        async function searchPosts() {
            const searchTerm = document.getElementById('searchTerm').value;
            const category = document.getElementById('categoryFilter').value;
            const authorId = document.getElementById('authorFilter').value;

            let url = `${API_BASE}/posts?page=0&size=10&sortBy=createdAt&sortDir=desc`;
            if (searchTerm) url += `&search=${encodeURIComponent(searchTerm)}`;
            if (category) url += `&category=${encodeURIComponent(category)}`;
            if (authorId) url += `&authorId=${encodeURIComponent(authorId)}`;

            try {
                const response = await fetch(url);
                const result = await response.json();
                displayResponse('postsResponse', result, response.ok);
            } catch (error) {
                displayResponse('postsResponse', {error: error.message}, false);
            }
        }

        // Get Post Details
        async function getPostDetails() {
            const postId = document.getElementById('postId').value;
            const viewerId = document.getElementById('viewerId').value;

            if (!postId) {
                alert('Please enter a post ID');
                return;
            }

            let url = `${API_BASE}/posts/${postId}`;
            if (viewerId) url += `?userId=${viewerId}`;

            try {
                const response = await fetch(url);
                const result = await response.json();
                displayResponse('postDetailsResponse', result, response.ok);
            } catch (error) {
                displayResponse('postDetailsResponse', {error: error.message}, false);
            }
        }

        // Update Post
        async function updatePost() {
            const postId = document.getElementById('updatePostId').value;
            const authorId = document.getElementById('updateAuthorId').value;
            const title = document.getElementById('updateTitle').value;
            const content = document.getElementById('updateContent').value;
            const category = document.getElementById('updateCategory').value;

            if (!postId || !authorId) {
                alert('Please enter both post ID and author ID');
                return;
            }

            const updateData = {};
            if (title) updateData.title = title;
            if (content) updateData.content = content;
            if (category) updateData.category = category;

            try {
                const response = await fetch(`${API_BASE}/posts/${postId}?authorId=${authorId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updateData)
                });

                const result = await response.json();
                displayResponse('updateResponse', result, response.ok);
            } catch (error) {
                displayResponse('updateResponse', {error: error.message}, false);
            }
        }

        // Like Post
        async function likePost() {
            const postId = document.getElementById('interactionPostId').value;
            const userId = document.getElementById('interactionUserId').value;

            if (!postId || !userId) {
                alert('Please enter both post ID and user ID');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/posts/${postId}/interactions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        userId: userId,
                        type: 'LIKE'
                    })
                });

                if (response.status === 204) {
                    displayResponse('interactionResponse', {message: 'Post unliked successfully'}, true);
                } else {
                    const result = await response.json();
                    displayResponse('interactionResponse', result, response.ok);
                }
            } catch (error) {
                displayResponse('interactionResponse', {error: error.message}, false);
            }
        }

        // Share Post
        async function sharePost() {
            const postId = document.getElementById('interactionPostId').value;
            const userId = document.getElementById('interactionUserId').value;

            if (!postId || !userId) {
                alert('Please enter both post ID and user ID');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/posts/${postId}/interactions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        userId: userId,
                        type: 'SHARE'
                    })
                });

                const result = await response.json();
                displayResponse('interactionResponse', result, response.ok);
            } catch (error) {
                displayResponse('interactionResponse', {error: error.message}, false);
            }
        }

        // Bookmark Post
        async function bookmarkPost() {
            const postId = document.getElementById('interactionPostId').value;
            const userId = document.getElementById('interactionUserId').value;

            if (!postId || !userId) {
                alert('Please enter both post ID and user ID');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/posts/${postId}/interactions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        userId: userId,
                        type: 'BOOKMARK'
                    })
                });

                const result = await response.json();
                displayResponse('interactionResponse', result, response.ok);
            } catch (error) {
                displayResponse('interactionResponse', {error: error.message}, false);
            }
        }

        // Check Like Status
        async function checkLikeStatus() {
            const postId = document.getElementById('interactionPostId').value;
            const userId = document.getElementById('interactionUserId').value;

            if (!postId || !userId) {
                alert('Please enter both post ID and user ID');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/posts/${postId}/likes/check?userId=${userId}`);
                const result = await response.json();
                displayResponse('interactionResponse', {hasLiked: result}, response.ok);
            } catch (error) {
                displayResponse('interactionResponse', {error: error.message}, false);
            }
        }

        // Check Bookmark Status
        async function checkBookmarkStatus() {
            const postId = document.getElementById('interactionPostId').value;
            const userId = document.getElementById('interactionUserId').value;

            if (!postId || !userId) {
                alert('Please enter both post ID and user ID');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/posts/${postId}/bookmarks/check?userId=${userId}`);
                const result = await response.json();
                displayResponse('interactionResponse', {hasBookmarked: result}, response.ok);
            } catch (error) {
                displayResponse('interactionResponse', {error: error.message}, false);
            }
        }

        // Add Comment
        async function addComment() {
            const postId = document.getElementById('commentPostId').value;
            const content = document.getElementById('commentContent').value;
            const authorId = document.getElementById('commentAuthorId').value;
            const parentCommentId = document.getElementById('parentCommentId').value;

            if (!postId || !content || !authorId) {
                alert('Please fill in post ID, content, and author ID');
                return;
            }

            const commentData = {
                content: content,
                authorId: authorId
            };

            if (parentCommentId) {
                commentData.parentCommentId = parentCommentId;
            }

            try {
                const response = await fetch(`${API_BASE}/posts/${postId}/comments`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(commentData)
                });

                const result = await response.json();
                displayResponse('commentResponse', result, response.ok);

                if (response.ok) {
                    document.getElementById('commentContent').value = '';
                    document.getElementById('parentCommentId').value = '';
                }
            } catch (error) {
                displayResponse('commentResponse', {error: error.message}, false);
            }
        }

        // Get Comments
        async function getComments() {
            const postId = document.getElementById('commentPostId').value;

            if (!postId) {
                alert('Please enter a post ID');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/posts/${postId}/comments?page=0&size=10`);
                const result = await response.json();
                displayResponse('commentResponse', result, response.ok);
            } catch (error) {
                displayResponse('commentResponse', {error: error.message}, false);
            }
        }

        // Admin Functions
        async function getTopViewedPosts() {
            try {
                const response = await fetch(`${API_BASE}/admin/metrics/top-viewed-posts`);
                const result = await response.json();
                displayResponse('adminResponse', result, response.ok);
            } catch (error) {
                displayResponse('adminResponse', {error: error.message}, false);
            }
        }

        async function getTopLikedPosts() {
            try {
                const response = await fetch(`${API_BASE}/admin/metrics/top-liked-posts`);
                const result = await response.json();
                displayResponse('adminResponse', result, response.ok);
            } catch (error) {
                displayResponse('adminResponse', {error: error.message}, false);
            }
        }

        async function getPlatformStats() {
            try {
                const response = await fetch(`${API_BASE}/admin/metrics/platform-stats`);
                const result = await response.json();
                displayResponse('adminResponse', result, response.ok);
            } catch (error) {
                displayResponse('adminResponse', {error: error.message}, false);
            }
        }

        async function getUserStats() {
            const userId = document.getElementById('adminUserId').value;

            if (!userId) {
                alert('Please enter a user ID');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/admin/metrics/user-stats/${userId}`);
                const result = await response.json();
                displayResponse('adminResponse', result, response.ok);
            } catch (error) {
                displayResponse('adminResponse', {error: error.message}, false);
            }
        }

        // Helper function to display response
        function displayResponse(elementId, data, isSuccess) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `response ${isSuccess ? 'success' : 'error'}`;
            element.textContent = JSON.stringify(data, null, 2);
        }
    </script>
</body>
</html>

